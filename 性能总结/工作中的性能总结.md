---
title: 工作中的性能总结
toc: true
date: 2022-03-04 22:26:59
tags:
- 
categories:
- 
typora-root-url: ..\img
---

##### 广告创意读取

由于要迁移mongodb库，由于启动程序的时候全量从mongodb拉素材比较慢，因此通过本地加载的方式拉全量，程序做增量变更

旧mongodb库是500万数据，新的mongodb是340万数据；

**旧方案：本地插件程序dump mongodb的数据为flatbuffer二进制数据，saasrs直接序列化到内存的flatbuffer 结构中**

**新方案1：mongodb export【官方出品】插件 导出为json数据文件，然后saas rs 读取json并解析到PadCreative结构中**

新方案2：mongodb export插件 导出为json文件后进行gz压缩，saas rs 读取后进行解压，然后解析到PadCreative结构中

新方案3：mongodb export插件 导出为json文件后，按行读取后放入队列，多线程解析并加锁写入内存数据结构

**结论**：按照耗和整个处理过程来说，目前用方案3；因为导出的过程可以放到平台，同时也可以去掉增量更新锁。

| 总条数  | 实际加载条数 | 文件大小               | 全量数据解析为结构体的耗时 |
| ------- | ------------ | ---------------------- | -------------------------- |
| 3377324 | 3364382      | creative.json（2.4G）  | 55秒                       |
| 3377324 | 3364382      | creative.json.gz(250m) | 60秒                       |
| 3377324 | 3377324      | creative.json（2.4G）  | 16秒                       |



<!-- more -->

