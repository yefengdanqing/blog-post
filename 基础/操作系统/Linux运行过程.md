---
title: Linux加载程序过程
toc: true
date: 2022-03-04 22:26:59
tags:
- 
categories:
- 
typora-root-url: ..\img
---

计算机领域的任何问题都可以增加一个间接的中间层来解决

- 虚拟内存

  - 物理地址空间不隔离的
  - 内存利用率较低
  - 程序运行的地址空间不确定
  - 通过cpu的mmu进行页内存映射

- 线程共享的内容

  ![image-20220323143913994](https://raw.githubusercontent.com/yefengdanqing/picture_bed/master/img/image-20220323143913994.png)

###### 目标文件

程序源代码编译后的机器指令经常被放在代码段（code section）里，叫".code" 或者".text";全局变量和静态变量都在数据段，数据段的一般名字叫".data";

.data：保存初始化的全局变量和局部静态变量

bss：未初始化的全局变量和局部静态变量存放的地方；其实这些数据也可以放在data段；由于都是0没有必要放。程序运行的时候他们的确是占内存空间的，并且可执行文件必须记录所有未初始化的全局变量和局部静态变量的大小总和，所以bss段只是为变量预留位置而已，在文件中并不占空间；

<!-- more -->

总体来说，程序源代码被编译后主要分成两段：程序指令和程序数据。代码段是程序指令，数据段和bss段属于程序数据。

分开的理由：

- 程序指令只是需要用来读；而数据是用来可读可写的
- cpu可能数据缓存和指令缓存（cache），分开后可以提高命中率
- 有多个程序的进程的时候，只需要一份程序指令就行

![image-20220323172822696](https://raw.githubusercontent.com/yefengdanqing/picture_bed/master/img/image-20220323172822696.png)

##### 可执行文件的装载与进程

可执行文件：打包指令和数据的文件

程序在运行的时候有局部性原理，所以我们可以将程序最常用的部分驻留在内存中，而将一些不太常见的数据存放在磁盘里面，这就是动态载入

###### 页映射

![image-20220327170055478](/C:/Users/sunketo/AppData/Roaming/Typora/typora-user-images/image-20220327170055478.png)

###### 进程的建立

- 步骤
  1. 创建一个独立的虚拟地址空间
  2. 读取可执行文件头，并且建立虚拟空间与可执行文件的映射关系
  3. 将cpu的指令寄存器设置成可执行文件的入口地址，启动运行



