---
title: ssh免密登录配置
toc: true
date: 2022-08-04 22:26:59
tags:
- 
categories:
- 
typora-root-url: ..\img
---

#### 问题

出现如下错误

```shell
Permission denied (publickey,gssapi-keyex,gssapi-with-mic)
```

#### 解决

1. 客户端即A端生成RSA公钥和私钥 ssh-keygen

   <!-- more -->

2. 客户端将自己的公钥存放到服务器：在生成了公私钥之后要实现AB两端的交互认证，这两个文件肯定不能只放到A端，当然也需要在B端（服务器端）做一下登记，我们自己（A端）保留自己的私钥，然后把公钥id_rsa.pub存放到B端（一般是在用户根目录下的.ssh/目录下

3. 配置sshd服务选项

   ```shell
   vim /etc/ssh/sshd_config 
   ```

   

   ```shell 
   #GSSAPIAuthentication yes 
   
   #GSSAPICleanupCredentials no
   PermitRootLogin no
   PubkeyAuthentication yes
   ChallengeResponseAuthentication yes
   RSAAuthentication yes
   
   #PasswordAuthentication?
   
   ```

   ![image-20230227141430662](https://raw.githubusercontent.com/yefengdanqing/picture_bed/master/image-20230227141430662.png)

4. 设置权限

   ```shell
   //用户权限
   
       chmod 700 /home/username
   
       //.ssh文件夹权限
   
       chmod 700 ~/.ssh/
   
       // ~/.ssh/authorized_keys 文件权限
   
       chmod 600 ~/.ssh/authorized_keys
       #ssh-copy-id -i ~/.ssh/id_rsa.pub root@192
   ```
   
   

#### 其他

使用ssh-copy-id进行copy

查看日志`tail /var/log/secure -n 100`

如果通过跳机登录，拷贝客户端机器和跳机的公钥key到最终的目的机器

可以通过grep sshd /var/log/secure日志来定位
